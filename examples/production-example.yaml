name: Production VCL - API routing

# This test demonstrates the new AST-based backend replacement
# Backend names must match the backend declarations in the VCL
# The parser will automatically replace the real production hostnames
# with test mock server addresses

backends:
  api_production:
    status: 200
    headers:
      Content-Type: "application/json"
      X-Service: "API"
    body: '{"message": "API response"}'

  web_production:
    status: 200
    headers:
      Content-Type: "text/html"
      X-Service: "Web"
    body: "<html>Web content</html>"

  legacy_service:
    status: 200
    headers:
      X-Service: "Legacy"
    body: "Legacy response"

scenario:
  # Test API request routes to api_production
  - at: "0s"
    request:
      url: /api/users
    expectations:
      response:
        status: 200
        headers:
          X-Backend-Used: "api_production"
          X-Service: "API"
      backend:
        used: "api_production"

  # Test web request routes to web_production
  - at: "1s"
    request:
      url: /index.html
    expectations:
      response:
        status: 200
        headers:
          X-Backend-Used: "web_production"
          X-Service: "Web"
      backend:
        used: "web_production"

  # Test legacy request routes to legacy_service
  - at: "2s"
    request:
      url: /legacy/old-api
    expectations:
      response:
        status: 200
        headers:
          X-Backend-Used: "legacy_service"
          X-Service: "Legacy"
      backend:
        used: "legacy_service"
